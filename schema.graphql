type MetaContract @entity {
  id: String!
  abi: String!
}

#                                                                  
# ██   ██  █████  ████████  ██████ ██   ██ ███████ ██████  ███████ 
# ██   ██ ██   ██    ██    ██      ██   ██ ██      ██   ██ ██      
# ███████ ███████    ██    ██      ███████ █████   ██████  ███████ 
# ██   ██ ██   ██    ██    ██      ██   ██ ██      ██   ██      ██ 
# ██   ██ ██   ██    ██     ██████ ██   ██ ███████ ██   ██ ███████ 
# 

type PluggableHatcher @entity {
  id: Bytes!
  address: Bytes!
  contract: MetaContract!

  admin: Bytes!
  cubCount: BigInt!
  upgradeCount: BigInt!
  globalPaused: Boolean!
  hatcherRegistry: Nexus
  initialProgress: BigInt!
  globalFixesCount: BigInt!

  cubs: [Cub!]! @derivedFrom(field: "hatcher")
  globalFixes: [Fix!]! @derivedFrom(field: "globalFix")
  currentImplementation: PluggableHatcherImplementation
  implementations: [PluggableHatcherImplementation!]! @derivedFrom(field: "pluggableHatcher")

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

type Cub @entity {
  id: Bytes!
  address: Bytes!
  contract: MetaContract!

  paused: Boolean!
  progress: BigInt!
  constructionData: Bytes!

  hatcher: PluggableHatcher!
  appliedFixes: [Fix!]! @derivedFrom(field: "fix")

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

type Fix @entity {
  id: String!
  address: Bytes!

  index: BigInt
  deleted: Boolean

  fix: Cub
  globalFix: PluggableHatcher
  
  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

type PluggableHatcherImplementation @entity {
  id: String!
  address: Bytes!

  pluggableHatcher: PluggableHatcher!

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

# 
# ███    ██ ███████ ██   ██ ██    ██ ███████ 
# ████   ██ ██       ██ ██  ██    ██ ██      
# ██ ██  ██ █████     ███   ██    ██ ███████ 
# ██  ██ ██ ██       ██ ██  ██    ██      ██ 
# ██   ████ ███████ ██   ██  ██████  ███████ 
#                                            

type Nexus @entity {
  id: Bytes!
  address: Bytes!
  contract: MetaContract!

  admin: Bytes!
  globalOracle: Bytes!
  globalRecipient: Bytes!
  depositContract: Bytes!
  minimalRecipientImplementation: Bytes!
  genesisTimestamp: BigInt!
  epochsUntilFinal: BigInt!
  slotsPerEpoch: BigInt!
  secondsPerSlot: BigInt!

  factoryHatcher: PluggableHatcher
  treasuryHatcher: PluggableHatcher
  poolHatcher: PluggableHatcher
  withdrawalRecipientHatcher: PluggableHatcher
  execLayerRecipientHatcher: PluggableHatcher
  coverageRecipientHatcher: PluggableHatcher
  oracleAggregatorHatcher: PluggableHatcher
  factories: [vFactory!]! @derivedFrom(field: "nexus")
  hatchers: [PluggableHatcher!]! @derivedFrom(field: "hatcherRegistry")

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

# 
# ███████  █████   ██████ ████████  ██████  ██████  ██    ██ 
# ██      ██   ██ ██         ██    ██    ██ ██   ██  ██  ██  
# █████   ███████ ██         ██    ██    ██ ██████    ████   
# ██      ██   ██ ██         ██    ██    ██ ██   ██    ██    
# ██      ██   ██  ██████    ██     ██████  ██   ██    ██    
#                                                            

type vFactory @entity {
  id: Bytes!
  address: Bytes!
  contract: MetaContract!

  version: BigInt!
  operator: Bytes
  admin: Bytes
  minimalRecipientImplementation: Bytes
  operatorName: String!
  operatorUrl: String!
  operatorIconUrl: String!

  cub: Cub!
  withdrawalChannels: [WithdrawalChannel!]! @derivedFrom(field: "factory")
  depositors: [FactoryDepositor!]! @derivedFrom(field: "factory")
  pools: [vPool!]! @derivedFrom(field: "factory")
  nexus: Nexus
  treasury: vTreasury

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

type WithdrawalChannel @entity {
  id: String!

  withdrawalChannel: Bytes!
  total: BigInt!
  funded: BigInt!
  limit: BigInt!

  keys: [ValidationKey!]! @derivedFrom(field: "withdrawalChannel")
  factory: vFactory!
  lastValidatorRequest: ValidatorRequest

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

type ValidatorRequest @entity {
  id: String!

  requestedTotal: BigInt!
  totalOnRequest: BigInt!

  withdrawalChannel: WithdrawalChannel!

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}


type ValidationKey @entity {
  id: String!

  publicKey: Bytes!
  signature: Bytes!
  index: BigInt!

  funded: FundedValidationKey
  withdrawalChannel: WithdrawalChannel!

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

type FundedValidationKey @entity {
  id: String!

  validatorId: BigInt!
  owner: Bytes
  feeRecipient: Bytes
  extraData: String

  lastExitRequest: ExitRequest
  validationKey: ValidationKey!

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

type ExitRequest @entity {
  id: String!

  emitter: Bytes!

  validator: FundedValidationKey!

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

type FactoryDepositor @entity {
  id: String! 
  address: Bytes!

  factory: vFactory!

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

# 
# ████████ ██████  ███████  █████  ███████ ██    ██ ██████  ██    ██ 
#    ██    ██   ██ ██      ██   ██ ██      ██    ██ ██   ██  ██  ██  
#    ██    ██████  █████   ███████ ███████ ██    ██ ██████    ████   
#    ██    ██   ██ ██      ██   ██      ██ ██    ██ ██   ██    ██    
#    ██    ██   ██ ███████ ██   ██ ███████  ██████  ██   ██    ██    
#                                                                    

type vTreasury @entity {
  id: Bytes!
  address: Bytes!

  cub: Cub!
  factory: vFactory!

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

# 
# ██████   ██████   ██████  ██      
# ██   ██ ██    ██ ██    ██ ██      
# ██████  ██    ██ ██    ██ ██      
# ██      ██    ██ ██    ██ ██      
# ██       ██████   ██████  ███████ 
#                                   

type vPool @entity {
  id: Bytes!
  address: Bytes!
  contract: MetaContract!

  purchasedValidatorCount: BigInt!
  totalSupply: BigInt!
  totalUnderlyingSupply: BigInt!
  operatorFee: BigInt!
  epochsPerFrame: BigInt!
  maxAPRUpperBound: BigInt!
  maxAPRUpperCoverageBoost: BigInt!
  maxRelativeLowerBound: BigInt!
  lastEpoch: BigInt!
  expectedEpoch: BigInt!

  cub: Cub!
  factory: vFactory!
  nexus: Nexus!
  depositors: [PoolDepositor!]! @derivedFrom(field: "pool")
  balances: [PoolBalance!]! @derivedFrom(field: "pool")
  purchasedValidators: [PoolPurchasedValidator!]! @derivedFrom(field: "pool")
  revenueUpdates: [RevenueUpdate!]! @derivedFrom(field: "pool")
  oracleAggregator: vOracleAggregator!
  coverageRecipient: vCoverageRecipient!
  execLayerRecipient: vExecLayerRecipient!
  withdrawalRecipient: vWithdrawalRecipient!

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

type PoolBalanceApproval @entity {
  id: String!
  address: Bytes!

  amount: BigInt!

  balance: PoolBalance!

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

type PoolBalance @entity {
  id: String!
  address: Bytes!

  amount: BigInt!
  totalApproval: BigInt!

  pool: vPool!
  approvals: [PoolBalanceApproval!]! @derivedFrom(field: "balance")

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

type PoolPurchasedValidator @entity {
  id: String!

  index: BigInt!

  pool: vPool!
  fundedValidationKey: FundedValidationKey!

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

type RevenueUpdate @entity {
  id: String!

  epoch: BigInt!
  delta: BigInt!
  covered: BigInt!
  totalSupply: BigInt!
  totalUnderlyingSupply: BigInt!
  execLayerSuppliedEther: ExecLayerSuppliedEther
  coverageSuppliedEther: CoverageSuppliedEther
  coverageVoidedShares: CoverageVoidedShares

  pool: vPool!

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

type PoolDepositor @entity {
  id: String! 
  address: Bytes!

  pool: vPool!

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

# 
# ███████ ██   ██ ███████  ██████     ██       █████  ██    ██ ███████ ██████      ██████  ███████  ██████ ██ ██████  ██ ███████ ███    ██ ████████ 
# ██       ██ ██  ██      ██          ██      ██   ██  ██  ██  ██      ██   ██     ██   ██ ██      ██      ██ ██   ██ ██ ██      ████   ██    ██    
# █████     ███   █████   ██          ██      ███████   ████   █████   ██████      ██████  █████   ██      ██ ██████  ██ █████   ██ ██  ██    ██    
# ██       ██ ██  ██      ██          ██      ██   ██    ██    ██      ██   ██     ██   ██ ██      ██      ██ ██      ██ ██      ██  ██ ██    ██    
# ███████ ██   ██ ███████  ██████     ███████ ██   ██    ██    ███████ ██   ██     ██   ██ ███████  ██████ ██ ██      ██ ███████ ██   ████    ██    
#                                                                                                                                                   

type vExecLayerRecipient @entity {
  id: Bytes!
  address: Bytes!
  contract: MetaContract!

  totalSuppliedEther: BigInt!

  suppliedEther: [ExecLayerSuppliedEther!]! @derivedFrom(field: "execLayerRecipient")
  cub: Cub!
  pool: vPool!
  
  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

type ExecLayerSuppliedEther @entity {
  id: String!

  amount: BigInt!
  execLayerRecipient: vExecLayerRecipient!

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

# 
#  ██████  ██████  ██    ██ ███████ ██████   █████   ██████  ███████     ██████  ███████  ██████ ██ ██████  ██ ███████ ███    ██ ████████ 
# ██      ██    ██ ██    ██ ██      ██   ██ ██   ██ ██       ██          ██   ██ ██      ██      ██ ██   ██ ██ ██      ████   ██    ██    
# ██      ██    ██ ██    ██ █████   ██████  ███████ ██   ███ █████       ██████  █████   ██      ██ ██████  ██ █████   ██ ██  ██    ██    
# ██      ██    ██  ██  ██  ██      ██   ██ ██   ██ ██    ██ ██          ██   ██ ██      ██      ██ ██      ██ ██      ██  ██ ██    ██    
#  ██████  ██████    ████   ███████ ██   ██ ██   ██  ██████  ███████     ██   ██ ███████  ██████ ██ ██      ██ ███████ ██   ████    ██    
#                                                                                                                                         

type vCoverageRecipient @entity {
  id: Bytes!
  address: Bytes!
  contract: MetaContract!

  totalAvailableEther: BigInt!
  totalSuppliedEther: BigInt!
  totalAvailableShares: BigInt!
  totalVoidedShares: BigInt!

  cub: Cub!
  pool: vPool!
  suppliedEther: [CoverageSuppliedEther!]! @derivedFrom(field: "coverageRecipient")
  voidedShares: [CoverageVoidedShares!]! @derivedFrom(field: "coverageRecipient")
  donors: [CoverageDonor!]! @derivedFrom(field: "coverageRecipient")
  
  createdAt: BigInt!
  editedAt: BigInt!

  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

type CoverageDonor @entity {
  id: String! 
  address: Bytes!

  coverageRecipient: vCoverageRecipient!

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

type CoverageSuppliedEther @entity {
  id: String!

  amount: BigInt!

  coverageRecipient: vCoverageRecipient!

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

type CoverageVoidedShares @entity {
  id: String!

  amount: BigInt!

  coverageRecipient: vCoverageRecipient!

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}


# 
# ██     ██ ██ ████████ ██   ██ ██████  ██████   █████  ██     ██  █████  ██          ██████  ███████  ██████ ██ ██████  ██ ███████ ███    ██ ████████ 
# ██     ██ ██    ██    ██   ██ ██   ██ ██   ██ ██   ██ ██     ██ ██   ██ ██          ██   ██ ██      ██      ██ ██   ██ ██ ██      ████   ██    ██    
# ██  █  ██ ██    ██    ███████ ██   ██ ██████  ███████ ██  █  ██ ███████ ██          ██████  █████   ██      ██ ██████  ██ █████   ██ ██  ██    ██    
# ██ ███ ██ ██    ██    ██   ██ ██   ██ ██   ██ ██   ██ ██ ███ ██ ██   ██ ██          ██   ██ ██      ██      ██ ██      ██ ██      ██  ██ ██    ██    
#  ███ ███  ██    ██    ██   ██ ██████  ██   ██ ██   ██  ███ ███  ██   ██ ███████     ██   ██ ███████  ██████ ██ ██      ██ ███████ ██   ████    ██    
#                                                                                                                                                      

type vWithdrawalRecipient @entity {
  id: Bytes!
  address: Bytes!

  withdrawalCredentials: Bytes!

  cub: Cub!
  pool: vPool!

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

# 
#  ██████  ██████   █████   ██████ ██      ███████      █████   ██████   ██████  ██████  ███████  ██████   █████  ████████  ██████  ██████  
# ██    ██ ██   ██ ██   ██ ██      ██      ██          ██   ██ ██       ██       ██   ██ ██      ██       ██   ██    ██    ██    ██ ██   ██ 
# ██    ██ ██████  ███████ ██      ██      █████       ███████ ██   ███ ██   ███ ██████  █████   ██   ███ ███████    ██    ██    ██ ██████  
# ██    ██ ██   ██ ██   ██ ██      ██      ██          ██   ██ ██    ██ ██    ██ ██   ██ ██      ██    ██ ██   ██    ██    ██    ██ ██   ██ 
#  ██████  ██   ██ ██   ██  ██████ ███████ ███████     ██   ██  ██████   ██████  ██   ██ ███████  ██████  ██   ██    ██     ██████  ██   ██ 
#                                                                                                                                           

type vOracleAggregator @entity {
  id: Bytes!
  address: Bytes!
  contract: MetaContract!

  memberCount: BigInt!
  quorum: BigInt!
  highestReportedEpoch: BigInt!

  cub: Cub!
  pool: vPool!
  members: [OracleAggregatorMember!]! @derivedFrom(field: "oracleAggregator")
  lastVariant: OracleAggregatorReportVariant
  variants: [OracleAggregatorReportVariant!]! @derivedFrom(field: "oracleAggregator")

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

type OracleAggregatorMember @entity {
  id: String!
  address: Bytes!

  index: BigInt!

  oracleAggregator: vOracleAggregator!

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

type OracleAggregatorReportVariant @entity {
  id: String!

  voteCount: BigInt!
  epoch: BigInt!
  validatorCount: BigInt!
  validatorBalanceSum: BigInt!
  validatorSlashedBalanceSum: BigInt!
  period: BigInt!
  submitted: Boolean!

  oracleAggregator: vOracleAggregator!
  votes: [OracleAggregatorReportVariantVote!]! @derivedFrom(field: "variant")

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

type OracleAggregatorReportVariantVote @entity {
  id: String!

  member: Bytes!
  globalMember: Boolean!

  variant: OracleAggregatorReportVariant!

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}


#
# ██ ███    ██ ████████ ███████  ██████  ██████   █████  ████████ ██  ██████  ███    ██ ███████ 
# ██ ████   ██    ██    ██      ██       ██   ██ ██   ██    ██    ██ ██    ██ ████   ██ ██      
# ██ ██ ██  ██    ██    █████   ██   ███ ██████  ███████    ██    ██ ██    ██ ██ ██  ██ ███████ 
# ██ ██  ██ ██    ██    ██      ██    ██ ██   ██ ██   ██    ██    ██ ██    ██ ██  ██ ██      ██ 
# ██ ██   ████    ██    ███████  ██████  ██   ██ ██   ██    ██    ██  ██████  ██   ████ ███████
#


type IntegrationChannel @entity {
  id: Bytes!
  name: String!
  implementation: Bytes!
  contract: MetaContract!

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

type vStake @entity {
  id: Bytes!
  vPool: vPool!

  address: Bytes!
  channel: IntegrationChannel!
  name: String!
  symbol: String!
  decimals: BigInt!

  integratorFee: BigInt!
  totalSupply: BigInt!
  totalUnderlyingSupply: BigInt!

  operatorCommissions: [OperatorCommission!]! @derivedFrom(field: "vStake")
  deposits: [vStakesDeposit!]! @derivedFrom(field: "vStake")
  balances: [vStakesBalance!]! @derivedFrom(field: "vStake")

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

type OperatorCommission @entity {
  id: String! # "{vStakesAddress}@{operatorAddres}"
  vStake: vStake!

  recipient: Bytes!
  commission: BigInt!
  withdrawnCommission: BigInt!

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

type vStakesDeposit @entity {
  id: String! # "{vStakesAddress}@{stakerAddress}@{txHash}"
  vStake: vStake!
  
  hash: Bytes!
  
  staker: Bytes!
  depositAmount: BigInt!
  mintedShares: BigInt!

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}

type vStakesBalance @entity {
  id: String! # "{vStakesAddress}@{stakerAddress}"
  vStake: vStake!
    
  staker: Bytes!
  underlyingBalance: BigInt!
  sharesBalance: BigInt!

  createdAt: BigInt!
  editedAt: BigInt!
  createdAtBlock: BigInt!
  editedAtBlock: BigInt!
}